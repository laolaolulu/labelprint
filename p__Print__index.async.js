"use strict";(self.webpackChunklabel_print=self.webpackChunklabel_print||[]).push([[663],{47789:function(je,N,e){e.r(N),e.d(N,{default:function(){return ge}});var z=e(26068),G=e.n(z),W=e(90228),o=e.n(W),Y=e(87999),Z=e.n(Y),K=e(48305),B=e.n(K),Q=e(40341),c=e(75271),n=e(52676),D,U=(0,c.forwardRef)(function(C,O){var h=(0,c.useState)(!1),S=B()(h,2),P=S[0],v=S[1],T=C.children,x=C.title,l=C.width,w=l===void 0?400:l;return(0,c.useImperativeHandle)(O,function(){return{open:function(){var i=Z()(o()().mark(function F(){var j;return o()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return v(!0),r.next=3,new Promise(function(t){D=t});case 3:return j=r.sent,v(!1),r.abrupt("return",j);case 6:case"end":return r.stop()}},F)}));function y(){return i.apply(this,arguments)}return y}()}}),(0,n.jsx)(Q.Y,{title:x,layout:"horizontal",style:{paddingTop:20},width:w,open:P,onFinish:function(){var i=Z()(o()().mark(function y(F){return o()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:D(F);case 1:case"end":return g.stop()}},y)}));return function(y){return i.apply(this,arguments)}}(),modalProps:{maskClosable:!1,destroyOnHidden:!0,onCancel:function(){D(void 0)}},children:T})}),X=e(20860),M=e(13143),q=e(30426),_=e(4645),ee=e(17934),ne=e(63488),re=e(1183),te=e(80998),ae=e(14724),le=e(38825),se=e(21833),ie=e(35182),ue=e(20344),de=e(78916),J=e(36932),oe=e(64741),I=e(29835),ce=e(57536),fe=e(14841),L=e(10183),R=e(78848),ve=e(81677),me=e(27674),$=e(87908),V=e(59188),E=e(71313),k=e(74581),he=e(42290),H=e(56928),pe=e(31641),f={basePdf:{width:150,height:100,padding:[0,0,0,0]},schemas:[[]]},ge=function(){var C=(0,L.useIntl)(),O=(0,c.useRef)(),h=(0,c.useRef)(null),S=(0,c.useState)(f),P=B()(S,2),v=P[0],T=P[1],x=(0,L.useModel)("settings"),l=x.templates,w=x.setDir,i=x.selectTemplate,y=x.setSelectTem,F=(0,c.useCallback)(Z()(o()().mark(function r(){var t;return o()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return R.ZP.info("\u8BF7\u9009\u62E9\u5E76\u6388\u6743\u52A0\u8F7D\u6253\u5370\u6A21\u677F\u7684\u76EE\u5F55"),d.next=3,window.showDirectoryPicker({mode:"readwrite"});case 3:t=d.sent,w("templates",t);case 5:case"end":return d.stop()}},r)})),[w]);(0,c.useEffect)(function(){return h.current=new fe.lg({domContainer:document.getElementById("container"),template:f,plugins:{text:se.Z,multiVariableText:ie.Z,table:ue.Z,line:de.Z,rectangle:J.C,ellipse:J.H,image:oe.Z,qrcode:I.Z.qrcode,barcodes:I.Z.code128,dateTime:ce.Z},options:{zoomLevel:1,sidebarOpen:!0,lang:C.locale.split("-")[0]}}),h.current.onChangeTemplate(function(r){T(r)}),function(){var r;(r=h.current)===null||r===void 0||r.destroy()}},[]),(0,c.useEffect)(function(){var r;l==null||(r=l.files.find(function(t){return t.name==i}))===null||r===void 0||r.text().then(function(t){var u;f=JSON.parse(t),(u=h.current)===null||u===void 0||u.updateTemplate(f)}),!j&&i&&ve.Z.confirm({title:"\u5F53\u524D\u6A21\u677F\u5DF2\u4FEE\u6539\u6682\u672A\u4FDD\u5B58",icon:(0,n.jsx)(X.Z,{}),content:"\u70B9\u51FB\u3010\u786E\u8BA4\u3011\u4FDD\u5B58\u5F53\u524D\u6A21\u677F\u7F16\u8F91\uFF1B\u70B9\u51FB\u3010\u53D6\u6D88\u3011\u5FFD\u7565\u4E22\u5F03\u5F53\u524D\u6A21\u677F\u7684\u7F16\u8F91\u9879",onOk:function(){g(i)}})},[i]);var j=(0,c.useMemo)(function(){return JSON.stringify(v)===JSON.stringify(f)},[v]),g=(0,c.useCallback)(function(r){l.dir.getFileHandle(r,{create:!0}).then(function(t){return t.createWritable()}).then(function(t){t.write(JSON.stringify(v)),t.close(),f=v,T(G()({},v))})},[l,v]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(me.Z,{justify:"space-between",style:{margin:10},children:[(0,n.jsxs)($.Z,{children:[(0,n.jsx)(V.Z.Button,{icon:(0,n.jsx)(M.Z,{}),menu:{items:[{key:"export",icon:(0,n.jsx)(q.Z,{}),disabled:!i,label:"\u5BFC\u51FA"},{type:"divider"},{key:"reset",icon:(0,n.jsx)(_.Z,{}),disabled:j,title:"\u4E22\u5F03\u6A21\u677F\u7F16\u8F91\u9879",label:"\u91CD\u7F6E"}],onClick:function(){var r=Z()(o()().mark(function u(d){var p,b,s,A;return o()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:a.t0=d.key,a.next=a.t0==="reset"?3:a.t0==="export"?6:20;break;case 3:return T(f),(p=h.current)===null||p===void 0||p.updateTemplate(f),a.abrupt("break",21);case 6:return a.next=8,window.showDirectoryPicker();case 8:return b=a.sent,a.next=11,b.getFileHandle(i,{create:!0});case 11:return s=a.sent,a.next=14,s.createWritable();case 14:return A=a.sent,a.next=17,A.write(l==null?void 0:l.files.find(function(ye){return ye.name==i}));case 17:return a.next=19,A.close();case 19:return a.abrupt("break",21);case 20:return a.abrupt("break",21);case 21:case"end":return a.stop()}},u)}));function t(u){return r.apply(this,arguments)}return t}()},buttonsRender:function(t){var u=B()(t,2),d=u[0],p=u[1];return[(0,n.jsx)(E.ZP,{icon:(0,n.jsx)(ee.Z,{}),disabled:j,onClick:Z()(o()().mark(function b(){var s;return o()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(!i){m.next=4;break}g(i),m.next=13;break;case 4:if(l){m.next=9;break}return m.next=7,F();case 7:return m.next=9,R.ZP.loading({content:"",duration:.5});case 9:return m.next=11,O.current.open();case 11:s=m.sent,s?g(s.name):R.ZP.error("\u672A\u547D\u540D\uFF0C\u53D6\u6D88\u4FDD\u5B58");case 13:case"end":return m.stop()}},b)})),children:"\u4FDD\u5B58"}),p]}}),(0,n.jsx)(k.Z,{type:"vertical"}),"\u6A21\u677F:",(0,n.jsx)(he.Z,{onChange:function(t){y(t)},value:i,style:{width:200},options:l==null?void 0:l.files.map(function(r){return{value:r.name}})}),(0,n.jsx)(V.Z,{menu:{items:[{key:"empty",label:"\u4ECE\u7A7A\u767D\u9875",icon:(0,n.jsx)(ne.Z,{})},{key:"2",label:(0,n.jsx)("a",{target:"_blank",rel:"noopener noreferrer",href:"https://www.antgroup.com",children:"\u4ECE\u5F53\u524D\u6A21\u677F"})},{key:"3",label:(0,n.jsx)("a",{target:"_blank",rel:"noopener noreferrer",href:"https://www.antgroup.com",children:"\u5BFC\u5165"})},{key:"read",icon:(0,n.jsx)(re.Z,{}),label:(0,n.jsxs)(n.Fragment,{children:["\u8BFB\u53D6",l?(0,n.jsx)(H.Z.Text,{type:"secondary",style:{marginLeft:10},children:l.dir.name}):(0,n.jsx)(H.Z.Text,{type:"warning",style:{marginLeft:10},children:"\u672A\u6388\u6743"})]})},{type:"divider"},{key:"4",label:(0,n.jsx)("a",{target:"_blank",rel:"noopener noreferrer",href:"https://www.antgroup.com",children:"\u5220\u9664"})}],onClick:function(){var r=Z()(o()().mark(function u(d){var p;return o()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:s.t0=d.key,s.next=s.t0==="read"?3:s.t0==="empty"?5:9;break;case 3:return F(),s.abrupt("break",10);case 5:return f={basePdf:{width:150,height:100,padding:[0,0,0,0]},schemas:[[]]},y(null),(p=h.current)===null||p===void 0||p.updateTemplate(f),s.abrupt("break",10);case 9:return s.abrupt("break",10);case 10:case"end":return s.stop()}},u)}));function t(u){return r.apply(this,arguments)}return t}()},children:(0,n.jsxs)(E.ZP,{icon:(0,n.jsx)(M.Z,{}),onClick:function(t){return t.preventDefault()},iconPosition:"end",children:["\u65B0\u5EFA",(0,n.jsx)(te.Z,{})]})}),(0,n.jsx)(k.Z,{type:"vertical"}),"\u5C3A\u5BF8",(0,n.jsx)($.Z.Compact,{block:!0,children:["width","height"].map(function(r){return(0,n.jsx)(pe.Z,{min:1,max:999,placeholder:r,style:{width:50},defaultValue:f.basePdf[r],controls:!1,onBlur:function(u){var d;v.basePdf[r]=Number(u.target.value),(d=h.current)===null||d===void 0||d.updateTemplate(v)}})})}),(0,n.jsx)(H.Z.Text,{type:"secondary",children:"mm"}),(0,n.jsx)(k.Z,{type:"vertical"})]}),(0,n.jsx)($.Z,{children:(0,n.jsx)(E.ZP,{icon:(0,n.jsx)(ae.Z,{}),children:"\u6253\u5370"})})]}),(0,n.jsx)("div",{id:"container",style:{height:"calc(100vh - 108.2px)"}}),(0,n.jsx)(U,{ref:O,title:"\u65B0\u5EFA\u6253\u5370\u6A21\u677F",children:(0,n.jsx)(le.Z,{name:"name",label:"\u6A21\u677F\u540D\u79F0",placeholder:"\u8BF7\u8F93\u5165\u65B0\u5EFA\u6A21\u677F\u540D\u79F0"})})]})}}}]);
